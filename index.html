<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fahim Survival Optimized</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
height:100vh;
overflow:hidden;
font-family:Segoe UI;
cursor:none;
position:relative;
background: linear-gradient(to bottom, #87ceeb 0%, #f0f8ff 100%);
}

/* Airplanes */
.airplane{
position:absolute;
top:0;
font-size:6vw;
opacity:0.8;
animation:airplaneMove linear infinite;
}
@keyframes airplaneMove{
0%{transform:translateX(-100px);}
100%{transform:translateX(110vw);}
}

header{
display:flex;
justify-content:space-between;
padding:1vh 3vw;
background:rgba(255,255,255,.3);
backdrop-filter:blur(5px);
border-radius:10px;
font-size:4vw;
}

#player{
position:absolute;
border-radius:50%;
box-shadow:0 0 20px cyan;
width:12vw;
touch-action:none;
}

.center{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
text-align:center;
}

button{
padding:2vh 5vw;
border:none;
border-radius:30px;
background:#ff004c;
color:white;
font-size:5vw;
cursor:pointer;
}

#overlay{
position:fixed;
width:100%;
height:100%;
background:rgba(0,0,0,.8);
display:none;
justify-content:center;
align-items:center;
flex-direction:column;
border-radius:10px;
text-align:center;
}

#overlay h1, #overlay h2{
color:white;
font-weight:bold;
text-shadow:2px 2px 4px black;
margin:1vh 0;
font-size:6vw;
}
</style>
</head>
<body>

<!-- Airplanes -->
<div class="airplane" style="top:5vh;animation-duration:60s;">üõ©Ô∏è</div>
<div class="airplane" style="top:15vh;animation-duration:80s;">üõ©Ô∏è</div>
<div class="airplane" style="top:25vh;animation-duration:100s;">üõ©Ô∏è</div>

<header>
<div>Score: <span id="score">0</span></div>
<div>‚ù§Ô∏è Lives: <span id="lives">3</span></div>
<div>High Score: <span id="highScore">0</span></div>
</header>

<div class="center" id="startScreen">
<h1>üå§ Fahim Sky Survival</h1>
<button onclick="startGame()">Start Game</button>
</div>

<img src="fahim.png" id="player">

<div id="overlay">
<h1>üíÄ Game Over</h1>
<h2>Score: <span id="finalScore"></span></h2>
<button onclick="location.reload()">Restart</button>
</div>

<audio id="explodeSound" src="explode.mp3"></audio>
<audio id="healthSound" src="health.mp3"></audio>
<audio id="minusSound" src="minus.mp3"></audio>
<audio id="bgMusic" src="bgmusic.mp3" loop></audio>

<script>
// -------- GAME STATE --------
let score=0, lives=3, maxLives=5, gameActive=false;
let highScore=localStorage.getItem("highScore")||0;
document.getElementById("highScore").innerText=highScore;

const player=document.getElementById("player");
const explodeSound=document.getElementById("explodeSound");
const healthSound=document.getElementById("healthSound");
const minusSound=document.getElementById("minusSound");
const bgMusic=document.getElementById("bgMusic");
bgMusic.volume=0.3;

let objects = []; // all enemies, health, minus

// -------- PLAYER START POSITION --------
function setPlayerStart(){
    player.onload = () => {
        player.x = window.innerWidth/2 - player.width/2;
        player.y = window.innerHeight*0.75 - player.height/2;
        updatePlayerPosition();
    };
    if(player.complete){
        player.x = window.innerWidth/2 - player.width/2;
        player.y = window.innerHeight*0.75 - player.height/2;
        updatePlayerPosition();
    }
}
function updatePlayerPosition(){
    player.style.transform = `translate(${player.x}px, ${player.y}px)`;
}

// -------- TOUCH DRAG --------
let dragging=false;
player.addEventListener('touchstart', e=>{dragging=true; e.preventDefault();});
player.addEventListener('touchend', e=>{dragging=false;});
player.addEventListener('touchmove', e=>{
    if(!dragging) return;
    let t=e.touches[0];
    player.x = t.pageX - player.width/2;
    player.y = t.pageY - player.height/2;
    constrainPlayer();
    updatePlayerPosition();
    e.preventDefault();
});

// -------- CONSTRAINT --------
function constrainPlayer(){
    player.x = Math.max(0, Math.min(window.innerWidth - player.width, player.x));
    player.y = Math.max(0, Math.min(window.innerHeight - player.height, player.y));
}

// -------- SPAWN OBJECTS --------
const maxEnemies=5, maxHealth=2, maxMinus=1;
const baseFallSpeed=2;

function spawnEnemy(){
    if(objects.filter(o=>o.type==='enemy').length >= maxEnemies) return;
    let el = document.createElement("img");
    el.src="fahim2.png"; el.className="enemy"; document.body.appendChild(el);
    objects.push({el,type:'enemy',x:Math.random()*(window.innerWidth-60),y:-60,speed:baseFallSpeed*getSpeedMultiplier()});
}
function spawnHealth(){
    if(objects.filter(o=>o.type==='health').length >= maxHealth) return;
    let el=document.createElement("img"); el.src="health.png"; el.className="health"; document.body.appendChild(el);
    objects.push({el,type:'health',x:Math.random()*(window.innerWidth-50),y:-50,speed:baseFallSpeed});
}
function spawnMinus(){
    if(objects.filter(o=>o.type==='minus').length >= maxMinus) return;
    let el=document.createElement("img"); el.src="minus.png"; el.className="minus"; document.body.appendChild(el);
    objects.push({el,type:'minus',x:Math.random()*(window.innerWidth-50),y:-50,speed:baseFallSpeed});
}

// -------- SPEED MULTIPLIER --------
function getSpeedMultiplier(){
    if(score>=30) return 2.5;
    if(score>=20) return 2;
    if(score>=10) return 1.5;
    return 1;
}

// -------- COLLISION --------
function checkCollision(a,b){
    let dx = (a.x + a.width/2) - (b.x + b.offsetWidth/2);
    let dy = (a.y + a.height/2) - (b.y + b.offsetHeight/2);
    let distance = Math.sqrt(dx*dx + dy*dy);
    return distance < (Math.max(a.width,a.height)/2 + Math.max(b.offsetWidth,b.offsetHeight)/2)*0.8;
}

// -------- LIFE HANDLERS --------
function gainLife(){
    if(lives<maxLives){lives++; document.getElementById("lives").innerText=lives; healthSound.play();}
}
function loseLife(){
    lives--; document.getElementById("lives").innerText=lives; explodeSound.play();
    if(navigator.vibrate){navigator.vibrate(200);}
    if(lives<=0) endGame();
}
function minusHit(){minusSound.play(); if(navigator.vibrate){navigator.vibrate(300);} endGame();}
function endGame(){
    gameActive=false; bgMusic.pause();
    if(score>highScore){localStorage.setItem("highScore",score);}
    document.getElementById("finalScore").innerText = score;
    document.getElementById("overlay").style.display="flex";
}

// -------- GAME LOOP --------
function gameLoop(){
    if(!gameActive) return;

    // spawn random objects
    if(Math.random()<0.02) spawnEnemy();
    if(Math.random()<0.005) spawnHealth();
    if(Math.random()<0.002) spawnMinus();

    objects.forEach((obj,index)=>{
        obj.y += obj.speed;
        obj.el.style.transform = `translate(${obj.x}px, ${obj.y}px)`;

        if(checkCollision(player,obj.el)){
            if(obj.type==='enemy') loseLife();
            if(obj.type==='health') gainLife();
            if(obj.type==='minus') minusHit();
            obj.el.remove();
            objects.splice(index,1);
        }else if(obj.y>window.innerHeight){
            obj.el.remove();
            objects.splice(index,1);
            if(obj.type==='enemy') score++;
        }
    });

    document.getElementById("score").innerText=score;
    requestAnimationFrame(gameLoop);
}

// -------- START GAME --------
function startGame(){
    document.getElementById("startScreen").style.display="none";
    gameActive=true;
    setPlayerStart();
    bgMusic.play();
    gameLoop();
}
</script>
</body>
</html>
